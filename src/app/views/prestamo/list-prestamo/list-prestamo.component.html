<div class="main-container">
  <header class="page-header">
    <div class="title-section">
      <button mat-icon-button (click)="goBack()" class="back-btn">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <h1>{{ cliente_id ? 'Préstamos de ' + clienteNombre : 'Gestión de Clientes' }}</h1>
        <p class="subtitle">Visualiza y gestiona el historial crediticio</p>
      </div>
    </div>

    <button mat-flat-button color="primary" class="add-btn" [routerLink]="['/prestamo/crear-prestamo']">
      <mat-icon>add</mat-icon>
      <span>Nuevo Préstamo</span>
    </button>
  </header>

  <div class="action-bar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <mat-label>Filtrar resultados...</mat-label>
      <input matInput (keyup)="applyFilter($event)" #input>
    </mat-form-field>
  </div>

  <div class="content-card mat-elevation-z2" *ngIf="!isMobile">
    <table mat-table [dataSource]="dataSource">

      <ng-container matColumnDef="prestamo_id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let row"> <span class="id-badge">#{{ row.prestamo_id }}</span> </td>
      </ng-container>

      <ng-container matColumnDef="saldo_pendiente">
        <th mat-header-cell *matHeaderCellDef> Saldo Pendiente </th>
        <td mat-cell *matCellDef="let row" class="amount text-danger"> 
          {{ row.saldo_pendiente | currency:'COP':'symbol':'1.0-0' }} 
        </td>
      </ng-container>

      <ng-container matColumnDef="valor_cuota">
        <th mat-header-cell *matHeaderCellDef> Cuota </th>
        <td mat-cell *matCellDef="let row" class="amount"> 
          {{ row.valor_cuota | currency:'COP':'symbol':'1.0-0' }} 
        </td>
      </ng-container>

      <ng-container matColumnDef="fecha_fin_prestamo">
  <th mat-header-cell *matHeaderCellDef> Finalización </th>
  <td mat-cell *matCellDef="let row"> 
    <div class="date-wrapper"> 
      <mat-icon>calendar_today</mat-icon>
      <span>{{ (row.fecha_fin_prestamo | date:'mediumDate') || 'No definida' }}</span>
    </div>
  </td>
</ng-container>

     <ng-container matColumnDef="actions">
  <th mat-header-cell *matHeaderCellDef> Acciones </th>
  <td mat-cell *matCellDef="let row" class="text-right">
    <button mat-button class="detail-btn" (click)="verDetalles(row)">
      <mat-icon>visibility</mat-icon>
      <span class="btn-text">Ver detalles</span>
    </button>
  </td>
</ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons></mat-paginator>
  </div>

  <div class="mobile-grid" *ngIf="isMobile">
    <mat-card class="modern-mobile-card" *ngFor="let row of dataSource.connect() | async" (click)="verDetalles(row)">
      <div class="card-accent" [ngClass]="row.estado?.toLowerCase() || 'activo'"></div>
      <div class="card-content">
        <div class="card-header-mobile">
          <span class="loan-number">Préstamo #{{ row.prestamo_id }}</span>
          <span class="status-dot"></span>
        </div>
        
        <div class="card-body-mobile">
          <div class="data-item">
            <label>Saldo</label>
            <span class="value highlight">{{ row.saldo_pendiente | currency:'COP':'symbol':'1.0-0' }}</span>
          </div>
          <div class="data-item">
            <label>Cuota</label>
            <span class="value">{{ row.valor_cuota | currency:'COP':'symbol':'1.0-0' }}</span>
          </div>
        </div>

        <div class="card-footer-mobile">
          <span>Vence: {{ row.fecha_fin_prestamo || 'Pendiente' }}</span>
          <mat-icon>chevron_right</mat-icon>
        </div>
      </div>
    </mat-card>
  </div>
</div>