<div class="main-page-wrapper">
  <div class="container">
    <header class="page-header">
      <div class="title-group">
        <button mat-icon-button routerLink="/usuario/list" class="back-btn-round">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="text-content">
          <h1>Editar Perfil</h1>
          <p class="subtitle">Modificando datos de: <strong>{{ usuarioNombreActual }}</strong></p>
        </div>
      </div>
    </header>

    <mat-card class="modern-card">
      <mat-card-content>
        <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()" class="animated-form">
          
          <div class="form-section">
            <h3 class="section-divider">Datos Personales</h3>
            <div class="form-grid">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Nombres</mat-label>
                <input matInput formControlName="nombres">
                <mat-icon matPrefix color="primary">person</mat-icon>
                <mat-error *ngIf="nombres?.invalid">{{ getNombresError() }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Apellidos</mat-label>
                <input matInput formControlName="apellidos">
                <mat-icon matPrefix color="primary">person</mat-icon>
                <mat-error *ngIf="apellidos?.invalid">{{ getApellidosError() }}</mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-divider">Contacto y Seguridad</h3>
            <div class="form-grid">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Teléfono</mat-label>
                <input matInput formControlName="telefono" placeholder="300 000 0000">
                <mat-icon matPrefix color="primary">smartphone</mat-icon>
                <mat-error *ngIf="telefono?.invalid">Formato de teléfono no válido</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Correo Electrónico</mat-label>
                <input matInput formControlName="email" type="email">
                <mat-icon matPrefix color="primary">alternate_email</mat-icon>
                <mat-error *ngIf="email?.invalid">{{ getEmailError() }}</mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-divider">Privilegios y Estado</h3>
            <div class="form-grid">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Rol en el Sistema</mat-label>
                <mat-select formControlName="tipo_usuario">
                  <mat-option *ngFor="let tipo of tiposUsuario" [value]="tipo.id">
                    {{ tipo.nombre }}
                  </mat-option>
                </mat-select>
                <mat-icon matPrefix color="primary">admin_panel_settings</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Estado de Cuenta</mat-label>
                <mat-select formControlName="estado">
                  <mat-option *ngFor="let est of estados" [value]="est.value">
                    <span [class]="'status-indicator ' + est.value"></span>
                    {{ est.label }}
                  </mat-option>
                </mat-select>
                <mat-icon matPrefix color="primary">verified_user</mat-icon>
              </mat-form-field>
            </div>
          </div>

          <div class="actions-footer">
            <button mat-button type="button" class="btn-cancel" (click)="onCancel()">
              Descartar cambios
            </button>
            <button mat-flat-button color="primary" type="submit" class="btn-save" [disabled]="loading || usuarioForm.invalid">
              <mat-spinner diameter="20" *ngIf="loading" class="white-spinner"></mat-spinner>
              <mat-icon *ngIf="!loading">update</mat-icon>
              <span>{{ loading ? 'Actualizando...' : 'Guardar Cambios' }}</span>
            </button>
          </div>

        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>