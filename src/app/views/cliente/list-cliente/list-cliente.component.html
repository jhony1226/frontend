<div class="main-container">
  <header class="page-header">
    <div class="title-section">
     <!-- <button mat-icon-button (click)="goBack()" class="back-btn" matTooltip="Regresar">
      <mat-icon>arrow_back</mat-icon>
    </button> -->
      <div>
        <h1>{{ mode === 'selectForLoan' ? 'Seleccione un Cliente' : 'Gestión de Clientes' }}</h1>
        <p class="subtitle">
          {{ mode === 'selectForLoan' ? 'Busca al cliente para ver sus Préstamos' : 'Administra informacion de clientes' }}
        </p>
      </div>
    </div>

    <button *ngIf="mode !== 'selectForLoan'" mat-flat-button color="primary" class="add-btn" [routerLink]="['/cliente/crear-cliente']">
      <mat-icon>add</mat-icon>
      <span>Nuevo Cliente</span>
    </button>
  </header>

  <div class="action-bar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <mat-label>Buscar por nombre o identificación...</mat-label>
      <input matInput (keyup)="applyFilter($event)" #input>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-select">
      <mat-label>Filtrar por Ruta</mat-label>
      <mat-select [formControl]="rutaFilter">
        <mat-option value="">Todas las rutas</mat-option>
        <mat-option *ngFor="let ruta of rutas" [value]="ruta">Ruta {{ ruta }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="content-card" *ngIf="!isMobile">
    <table mat-table [dataSource]="dataSource">

      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Cliente </th>
        <td mat-cell *matCellDef="let row">
          <div class="client-info">
            <span class="main-text">{{ row.nombres }} {{ row.apellidos }}</span>
            <span class="sub-text">ID: {{ row.numero_identificacion }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="apellido">
        <th mat-header-cell *matHeaderCellDef> Apellido </th>
        <td mat-cell *matCellDef="let row"> {{ row.apellidos }} </td>
      </ng-container>

      <ng-container matColumnDef="identificacion">
        <th mat-header-cell *matHeaderCellDef> Identificación </th>
        <td mat-cell *matCellDef="let row"> {{ row.numero_identificacion }} </td>
      </ng-container>

      <ng-container matColumnDef="telefono">
        <th mat-header-cell *matHeaderCellDef> Teléfono </th>
        <td mat-cell *matCellDef="let row" class="phone-cell">
          <mat-icon inline>phone</mat-icon> {{ row.telefono }}
        </td>
      </ng-container>

      <ng-container matColumnDef="ruta">
        <th mat-header-cell *matHeaderCellDef> Ruta </th>
        <td mat-cell *matCellDef="let row">
          <span class="ruta-badge">R-{{ row.id_ruta }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let row">
          <div class="status-badge" [ngClass]="row.estado.toLowerCase() || ''">
            <mat-icon *ngIf="row.estado.toLowerCase() === 'activo'">check_circle</mat-icon>
            <mat-icon *ngIf="row.estado.toLowerCase() === 'inactivo'">cancel</mat-icon>
            <span>{{ row.estado }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-right"> Acciones </th>
        <td mat-cell *matCellDef="let row" class="text-right">
          <div class="action-buttons">
            <ng-container *ngIf="mode === 'selectForLoan'">
              <button mat-button class="detail-btn" (click)="verPrestamosCliente(row)">
                <mat-icon>check_circle</mat-icon>
                <span>SELECCIONAR</span>
              </button>
            </ng-container>

            <ng-container *ngIf="mode !== 'selectForLoan'">
              <button mat-icon-button class="edit-icon" [routerLink]="['/cliente/editar-cliente', row.cliente_id]" matTooltip="Editar">
                <mat-icon>edit_square</mat-icon>
              </button>
              <button mat-icon-button class="delete-icon" (click)="deleteCliente(row)" matTooltip="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </ng-container>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>
    </table>
      <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons></mat-paginator>
 
    </div>
  
   <div class="mobile-grid" *ngIf="isMobile">
  <mat-card class="modern-mobile-card" *ngFor="let row of dataSource.connect() | async">
    
    <div class="card-header-mobile">
      <div class="header-main">
        <div class="avatar-placeholder">
          {{ (row.nombres.charAt(0) || 'C') | uppercase }}
        </div>
        
        <div class="client-identity">
          <span class="client-name" [matTooltip]="row.nombres + ' ' + row.apellidos">
            {{ row.nombres }} {{ row.apellidos }}
          </span>
          <span class="ruta-subtext">Ruta {{ row.id_ruta }}</span>
        </div>
      </div>

      <div class="status-badge mini" [ngClass]="row.estado.toLowerCase() || ''">
        <span>{{ row.estado }}</span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="card-body-mobile">
      <div class="info-row">
        <div class="icon-wrapper"><mat-icon>badge</mat-icon></div>
        <div class="info-content">
          <span class="label">Identificación</span>
          <span class="value">{{ row.numero_identificacion }}</span>
        </div>
      </div>
      
      <div class="info-row">
        <div class="icon-wrapper"><mat-icon>phone_iphone</mat-icon></div>
        <div class="info-content">
          <span class="label">Móvil</span>
          <span class="value">{{ row.telefono }}</span>
        </div>
      </div>
    </div>

    <div class="card-footer-mobile">
      <ng-container *ngIf="mode === 'selectForLoan'">
        <button mat-flat-button color="primary" class="full-w-btn" (click)="verPrestamosCliente(row)">
          <mat-icon>check_circle</mat-icon> SELECCIONAR CLIENTE
        </button>
      </ng-container>

      <ng-container *ngIf="mode !== 'selectForLoan'">
        <div class="mobile-action-grid">
          <button mat-stroked-button class="btn-pill btn-edit" [routerLink]="['/cliente/editar-cliente', row.cliente_id]">
            <mat-icon>edit</mat-icon>
            <span>EDITAR</span>
          </button>
          <button mat-stroked-button class="btn-pill btn-delete" (click)="deleteCliente(row)">
            <mat-icon>delete</mat-icon>
            <span>ELIMINAR</span>
          </button>
        </div>
      </ng-container>
    </div>
  </mat-card>
</div>
</div>